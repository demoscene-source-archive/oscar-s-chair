#pragma data_seg(".shader")
const char* fragment =
 "#version 130\n"
 "vec2 v=gl_FragCoord.xy/1280;"
 "uniform sampler2D a;"
 "float y=gl_TexCoord[0].x/44100,i,m,s=1,f;"
 "vec3 c=vec3(7,5,19),z=vec3(-4,0,3),x,r,g=vec3(0,5,-7),e;"
 "float n(vec2 r,float v)"
 "{"
   "float y=0,c=1,m=1;"
   "for(int x=0;x<f;++x)"
     "y+=(texture(a,(r+x*40)*c/vec2(1280,640)).z*2-1)*(m/=v),c*=2;"
   "return y;"
 "}"
 "float p(vec2 v,out vec3 x)"
 "{"
   "vec2 a=v;"
   "float m;"
   "if(i==0)"
     "{"
       "v+=n(v,2)/50;"
       "v+=floor(v*vec2(.6,7)+12*cos(floor(v.y*4.5)))*31;"
       "x=vec3(1,.57,.2)*(3+n(v,2))/16+n(v*vec2(.8,16),2)/30;"
       "if(y>25&&y<=60&&a.y<1)"
         "x=mix(x,vec3(1,.01,.01)/9,smoothstep(.2,.204,n(a,2.3)));"
       "m=.15+.017*n(v*vec2(.12,12)+n(v,2)/2,1.4)+x.x/2;"
       "x*=pow(m,4)*168;"
       "return m;"
     "}"
   "if(abs(v.x)<1.5&&abs(v.y-3)<3&&r.z<-c.z+.1)"
     "{"
       "x=vec3(n(v*vec2(1,.2),2)+2)/4;"
       "v=abs(v+n(v,2)/60-vec2(0,3));"
       "if(v.x>1.475||v.y>2.975)"
         "x*=.3;"
       "return 11-clamp(abs(max(abs(v.x-.7)+.3,abs(v.y-1.4)-.3)-.7),.05,.14)*11+n(v*vec2(1,.2),2.5);"
     "}"
   "m=1-smoothstep(.1,.12,n(v/2+10,2.5)-.1);"
   "x=mix(vec3(.7),mix(vec3(1,1,.5)/1.4+n(v*8,1.2)/15,vec3(.65,1,.5),m)/4*min(v.y*3-1.5+.8,1),step(.5,v.y))-step(.4,n(v*3,1.6))/140;"
   "return n(v,2)/2-x.y*4;"
 "}"
 "vec3 t(vec2 v,out vec3 y)"
 "{"
   "return x=vec3(.004,0,0),normalize(vec3(p(v+x.xy,y)-p(v-x.xy,y),.16,p(v+x.yx,y)-p(v-x.yx,y)));"
 "}"
 "float n(vec3 v)"
 "{"
   "float r=y>81?-1.4:-2.827;"
   "v-=z;"
   "v.y+=(n(v.xz*=mat2(cos(r),sin(r),-sin(r),cos(r)),2.5)/2+.5)*clamp(y/3-29,0,5)+c.y-1.25;"
   "v.x+=n(v.yz,2.5)*clamp(y/3-29,0,5)-max(0,v.y)/10;"
   "v.z=abs(v.z);"
   "return min(min(min(max(length(max(abs(v.xz)-vec2(.45,.41),0))-.25,abs(v.y)-.02),length(v-vec3(clamp(v.x,-.6,.6),-.1,.6))-.025),length(vec3(abs(v.x)-.6+min(0,v.y)/5,v.y-clamp(v.y,-1.24,1.5*step(0,v.x)),v.z-.6))-.025),max(length(max(abs(v.yz-vec2(1,0))-vec2(.5,.35),0))-.25,abs(v.x-.6)-.03));"
 "}"
 "float h(vec3 v,vec3 x)"
 "{"
   "float y=0,r=0;"
   "for(;r<200&&y<30;++r)"
     "i=min(i,m=n(v+x*y)),y+=m/2;"
   "return y;"
 "}"
 "vec3 w(vec3 v,vec3 a)"
 "{"
   "vec3 f;"
   "r=v+a*(m=min((sign(a.x)*c.x-v.x)/a.x,min((sign(a.y)*c.y-v.y)/a.y,(sign(a.z)*c.z-v.z)/a.z)));"
   "if(abs(r.y)>c.y-.001)"
     "i=0,x=t(r.xz/2,f),f*=min(vec3(.75,1,.75)+min(c.x-abs(r.x),c.z-abs(r.z))/4,1)*smoothstep(0,2.2,length(r-z-vec3(0,-c.y+1.25,0)));"
   "else"
     "{"
       "i=1;"
       "x=t(vec2(r.x-r.z-c.z,r.y+c.y),f).xzy;"
       "if(abs((r/c).x)>abs((r/c).z)&&abs((r/c).x)>abs((r/c).y))"
         "x=x.zyx*vec3(-sign(r.x),1,-1);"
       "f*=mix(vec3(1,1,.5),vec3(1),min((-abs(r.y)+c.y)/4,1))*sqrt(min((-abs(r.y)+c.y)*8+.4,1));"
     "}"
   "f*=mix(4,1,smoothstep(1,2,length(r/c)))*max(0,1+3*dot(x,normalize(g-r)))/16*(1-smoothstep(0,2.5,length(max(abs(r)-c+1,0))));"
   "f=(f+pow(clamp(dot(normalize(normalize(g-r)-a),x),0,1),64)*(f*.8+.2))*exp2(-length(g-r)/1.2)*s*20*mix(.02,2,smoothstep(.6,.7,dot(normalize(g-r),e)));"
   "if(y<=97)"
     "f+=pow(vec3(2.2,.7,.3)*exp(-abs(n(r.xz/2+r.y/4-y/2,1.5))*10*n(-r.xy+y-r.z,1.5)+n(r.xy-y/3,2)*6-r.y-c.y-r.z-c.z+(y-88)/4+r.x/9),vec3(2))/70;"
   "return f;"
 "}"
 "void main()"
 "{"
   "if(gl_TexCoord[0].y==0)"
     "gl_FragColor.xyz=vec3(gl_TexCoord[0].xx,fract(sin(float((int(gl_FragCoord.x)*19349663^int(gl_FragCoord.y)*83492791)%38069))*43758.5));"
   "else"
     " if(gl_TexCoord[0].y==1)"
       "{"
         "gl_FragColor*=0;"
         "for(int p=-6;p<=6;++p)"
           "for(int t=-6;t<=6;++t)"
             "if(t*t+p*p<37)"
               "gl_FragColor=mix(gl_FragColor,max(gl_FragColor,texelFetch(a,ivec2(gl_FragCoord.xy+vec2(t,p)*texelFetch(a,ivec2(gl_FragCoord.xy),0).w),0)),.06);"
       "}"
     "else"
       " if(abs((v.y+=.22)-.5)<.2)"
         "{"
           "vec3 t=vec3(0);"
           "for(int p=0;p<8;++p)"
             "{"
               "float l=2.7;"
               "vec3 o=vec3(10+y/4,-4,-1),d=vec3(-7,-2,0);"
               "m=0;"
               "if(y>97)"
                 "d=o=vec3(0,-4,y-97),d.z-=1,g=vec3(0,3,-22),s=.4,c=vec3(3,7,28),z=vec3(-4,0,13);"
               "else"
                 " if(y>81)"
                   "d=o=vec3(0,-3.6,97-y),d.z-=1,g=vec3(0,5,-5),s=.01,l=1.7,c=vec3(7,5,9),z=vec3(0,0,-2);"
                 "else"
                   " if(y>60)"
                     "o=vec3((y-60)/5-1,-2,13),d=vec3(-7,-5,-7),g=vec3(0,5,-3),m=sin(y-60)/10-.9,c=vec3(7,5,9),z=vec3(-4,0,2);"
                   "else"
                     " if(y>25)"
                       "o=vec3(0,0,25-y/2.7),d=vec3(0,-4,18-y/2.7),g=vec3(-2,5,-7),c=vec3(9,5,14),z=vec3(3.5,0,-6);"
                     "else"
                       " m=-.9;"
               "f=7;"
               "e=vec3(0,cos(m),sin(m));"
               "vec3 u=normalize(d-o),b=normalize(vec3(-u.z,0,u.x));"
               "if(y>81&&y<=97)"
                 "u.y+=n(vec2(y+6)/2,2)*.05,b.y+=n(vec2(y)/3,2)*.08;"
               "u=mat3(b,cross(b,u),u)*normalize(vec3(v*2+vec2(p&1,p/2)/1200-1,l));"
               "float C=h(o,u);"
               "if(C<30)"
                 "r=o+u*C,x=vec3(.02,0,0),x=normalize(vec3(n(r+x.xyy)-m,n(r+x.yxy)-m,n(r+x.yyx)-m)),f=2,b=w(r,reflect(u,x))*pow(1+dot(u,x),3);"
               "else"
                 "{"
                   "b=w(o,u);"
                   "l=(.3+.7*pow(1+dot(u,x),2)/4)*(.1+.9*step(r.y,-c.y+.01));"
                   "o=reflect(u,x);"
                   "C=m;"
                   "f=2;"
                   "i=100;"
                   "u=normalize(g-r);"
                   "h(r+u*.01,u);"
                   "b*=.4+.6*smoothstep(0,n(r)/5,i);"
                   "if(r.y<-c.y+.01)"
                     "if(h(r,o)<30)"
                       "l*=.2,b*=.7;"
                   "b+=w(r,o)*l*mix(vec3(1),b,.8);"
                 "}"
               "if(y>60&&y<=97)"
                 "gl_FragColor.w=y<=81?(C-15)/6:C/15;"
               "b*=smoothstep(0,2,abs(y-60))*smoothstep(0,3,abs(y-112))*(1-(pow(abs(v.x*2-1),4)+pow(abs(v.y*2-1)*2.5,4))*.4);"
               "b=pow(.003+b*40,vec3(1,1.1,1.2));"
               "t+=b/(b+.4)*1.1;"
             "}"
           "m=0;"
           "for(int p=0;p<64;++p)"
             "m+=texture(a,clamp((v-vec2(.4,.532)+vec2(p&7,p/8)/10000)*4*vec2(2.25,4),0,1)).x+texture(a,clamp((v-vec2(.38,.33)+vec2(p&7,p/8)/10000)*vec2(2.25,4),0,1)).y;"
           "gl_FragColor.xyz=sqrt(t/8)+m/104*clamp((6-abs(y-10))/5,0,1);"
         "}"
 "}";
